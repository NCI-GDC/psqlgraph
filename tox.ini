[tox]
envlist = py36,py37,py38,py39

[testenv]
usedevelop = True
deps =
    -rdev-requirements.txt
commands =
    python -m pytest -lv --cov psqlgraph --cov-report term --cov-report xml --cov-report html --junit-xml test-reports/results.xml {posargs}

[testenv:lint]
basepython = python3.8
skip_install = True
commands_pre =
deps =
    pre-commit
allowlist_externals =
    bash
commands =
    pre-commit run --all-files --show-diff-on-failure {posargs: }

[testenv:release]
deps =
    build
    twine
passenv =
    TWINE_PASSWORD
    TWINE_REPOSITORY
setenv =
    TWINE_USERNAME = {env:TWINE_USERNAME:__token__}
commands =
    python -c "import shutil; shutil.rmtree('dist', ignore_errors=True)"
    python -m build
    python -m twine upload dist/*
